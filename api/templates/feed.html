{% extends 'base-feed.html' %}



{% block content %}


<div class="max-w-screen-md mx-auto px-6 md:px-12 xl:px-6 mt-20">
    <div class="mx-auto text-left sm:text-center">
        <h1 class="text-gray-900 font-bold text-3xl md:text-5xl"><span style="color:{{ feed_color }};">{{ feed_name }}</span> Studies</h1>
        <p class="mt-4 mb-8 text-gray-700 text-lg md:text-xl">Today, <span class="font-semibold">{{ today_count }}</span> <span class="lowercase">{{ feed_name }}</span>-related articles were published.</p>

        <label for="searchBox" class="mb-2 text-sm font-medium text-gray-900 sr-only dark:text-white">Search</label>
        <form id="searchForm" action="/cancer/search" method="GET" class="relative max-w-xl mx-auto" autocomplete="off">
            <div class="absolute inset-y-0 start-0 flex items-center ps-3 pointer-events-none">
                <svg class="w-4 h-4 text-gray-500 dark:text-gray-400" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 20 20">
                    <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m19 19-4-4m0-7A7 7 0 1 1 1 8a7 7 0 0 1 14 0Z"></path>
                </svg>
            </div>
            <input type="text" id="searchBox" name="q" class="shadow-xl block w-full p-4 ps-10 text-sm text-gray-900 border border-gray-300 rounded-lg bg-white focus:ring-green-500 focus:border-green-500" placeholder="Search for anything..." required="">
            <button type="submit" class="hidden sm:inline-block text-white absolute end-2.5 bottom-2.5  hover:opacity-80 focus:ring-4 focus:outline-none focus:ring-green-300 font-medium rounded-lg text-sm px-4 py-2" style="background-color:{{ feed_color }};">Search</button>
            <div id="searchResults" class="absolute w-full bg-white shadow-lg rounded-b-lg text-left">
                <div id="results-div" class="p-4 rounded-b-lg border border-gray-300 bg-gray-50" style="display: none;">

                </div>
            </div>
        </form>
    </div>
</div>

<!-- USE GRADIENT TO DO MULTIPLE BORDER SECTION COLORS -->

<div class="px-4 mx-auto flex flex-col first-letter:items-center justify-center max-w-3xl mt-10">

    <div class="flex justify-between w-full max-w-5xl p-1.5 min-w-full align-middle -mb-4 text-gray-900">
        <div>
            <span class="font-semibold">Legend:</span> <span class="text-xs">Research, Review, Clinical Trial, News, Opinion</span>
        </div>
        <div>
            Sort by >
        </div>
    </div>

    <div class="flex flex-col w-full max-w-5xl p-1.5 min-w-full align-middle">
        <ul class="">
            {% for publication in publications %}
                {% set publication_index = loop.index0 %}
                {% set num_types = publication.publication_type | length %}
                <li class="list bg-white shadow rounded-r-lg my-8 relative">
                    <div style="height: 100%; position: absolute; left: 0; top: 0; width: 6px;">
                        {% for type in publication.publication_type %}
                            {% set color = publication_type_colors.get(type, '#6b7280') %}
                            {% set tooltip_id = 'tooltip-' ~ publication_index ~ '-' ~ loop.index0 %}
                            <div style="background-color: {{ color }}; width: 100%; height: {{ 100/num_types }}%;"
                                class="tooltip-target" data-tooltip-target="{{ tooltip_id }}"
                                data-tooltip-placement="right">
                            </div>
            
                            <div id="{{ tooltip_id }}" role="tooltip" class="absolute z-10 invisible inline-block px-3 py-2 text-sm font-medium text-white bg-gray-900 rounded-lg shadow-sm opacity-0 tooltip dark:bg-gray-700 text-nowrap">
                                {{ type }}
                                <div class="tooltip-arrow" data-popper-arrow></div>
                            </div>
                        {% endfor %}
                    </div>
                    <div class="p-4 !pl-6"> <!-- Added padding left to avoid overlay -->
                        <div class="flex justify-between">
                            <p class="text-sm text-gray-700 truncate">{{ publication.publication_type | join(', ') }}</p>
                            <p class="text-sm text-gray-700">{{ publication.published_date | timeago }}</p>
                        </div>
                        <h2 class="text-base font-semibold text-gray-900 mt-2">{{ publication.title }}</h2>
                        <div class="flex justify-between mt-2 gap-x-4">
                            <p class="text-sm text-gray-700 truncate">{{ publication.journal_info }}</p>
                            <a target="_blank" href="{{ publication.link }}" class="text-sm text-gray-900 ml-auto w-fit hover:underline text-nowrap">Read more ></a>
                        </div>
                    </div>
                    {% for publication in publications %}
                        {% for type in publication.publication_type %}
                        {% endfor %}
                    {% endfor %}
                </li>
            {% endfor %}
        </ul>
        <button id="load-more-btn">Load More</button>
    </div>
</div>





<!-- <div class="hidden bg-blue-700 bg-green-700 bg-yellow-700 bg-purple-700 bg-red-700 bg-gray-700 bg-indigo-700"></div> -->



<script>
    document.addEventListener('DOMContentLoaded', function () {
        const tooltipElements = document.querySelectorAll('.tooltip-target');
        tooltipElements.forEach(el => new Tooltip(el));
    });
</script>


<script>
    const FEED = '{{ feed_query }}';

    document.getElementById('load-more-btn').addEventListener('click', function () {
        var offset = document.querySelectorAll('.list').length;
        console.log(offset)
        fetch(`/load-more/${offset}`, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({ feed_query: FEED })
        })
            .then(response => response.text())
            .then(html => {
                if (html.includes('nomorepubs898')) {
                    alert('No more publications to load');
                } else {
                    document.querySelector('.list').innerHTML += html;
                }
            });
    });
</script>

{% endblock %}